<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>EasyQMK - Compiling</title>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script> -->

    <!-- Prism CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />

    <!-- Prism JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>

    <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  </head>
  <style>
    :root {
      font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
        "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
    }
    p,
    span,
    h1,
    h2,
    h3,
    div {
      color: white;
    }

    a {
      font-weight: bold;
      color: rgb(0, 204, 255);
    }
    a:visited {
      color: rgb(201, 6, 201);
    }

    .maincontainer {
      display: flex;
    }

    .logodiv {
      position: relative;
      background-image: url(./EasyQMK-Logo.png);
      background-size: cover;
      background-size: 100% 100%;
      color: white;
      width: 320px;
      height: 180px;
      margin: 2%;
      text-align: center;
    }
    .logodiv h3 {
      position: absolute;
      top: 100px;
      left: 180px;
      text-decoration: none;
    }
    .logodiv h3 a {
      text-decoration: none;
    }

    .dir {
      padding-right: 50px;
      width: fit-content;
      height: fit-content;
      margin-left: 4%;
      border: 2px solid white;
      border-radius: 5px;
      font-size: large;
    }
    .dir ul li {
      padding: 5px;
    }

    .inputs {
      width: 50%;
      float: left;
      margin: auto;
      margin-top: -100px;
    }
    #welcome {
      font-size: 5em;
      font-weight: 900;
    }
    p {
      font-size: large;
    }

    .inputs label {
      font-size: large;
      display: block;
    }
    .inputs input {
      margin-bottom: 10px;
      font-size: larger;
      width: 50px;
      border: 3px solid rgb(0, 204, 255);
      border-radius: 5px;
    }
    .example {
      display: block;
    }
    .example span {
      display: block;
      margin-top: 10px;
      margin-bottom: -50px;
      font-weight: 700;
    }
    .npbuts {
      position: fixed;
      width: 99%;
      bottom: 70px;
    }
    .npbuts button {
      width: 170px;
      height: 50px;
      font-size: larger;
      color: white;
      border: 3px solid white;
      border-radius: 5px;
    }
    #next {
      background-color: rgb(32, 173, 13);
      position: fixed;
      right: 10px;
      margin-left: auto;
      margin-right: 15px;
    }

    #prev {
      background-color: rgb(216, 59, 221);
      position: fixed;
      left: 10px;
      margin-right: auto;
      margin-left: 15px;
    }
    #prev:hover,
    #next:hover {
      background-color: rgb(9, 76, 151);
    }
    #prev:active,
    #next:active {
      background-color: rgb(201, 6, 201);
    }
    #links {
      margin-top: 40px;
      /* display: flex; */
    }
    #links div {
      margin: auto;
      border: 3px solid white;
      border-radius: 10px;
      padding: 10px;
      margin-top: 15px;
    }
    #links label {
      display: inline;
    }
    #links input {
      display: inline;
    }

    pre {
      border: 2px solid rgb(216, 59, 221);
      border-radius: 5px;
      font-size: larger;
      width: 300px;
      text-align: left;
      /* padding: 10px;
      padding-top: 20px; */
      width: auto;
    }

    .code-header {
      color: black;
      font-size: large;
      position: relative;
      top: 20px;
      left: 10px;
      padding: 5px;
      margin-top: -25px;
      background-color: rgb(244, 242, 240);
      border-radius: 5px;
    }

    #minidir li a {
      font-size: large;
      text-decoration: none;
    }
  </style>

  <body style="background-color: rgb(7, 3, 22); margin-bottom: 200px;">
    <div class="logodiv">
      <h3>By <a href="https://github.com/invictus-anic3tus">Anicetus</a></h3>
    </div>
    <div class="maincontainer">
      <div class="dir">
        <ul>
          <li><a href="./">Home</a></li>
          <li><a href="./start.html">Getting Started</a></li>
          <li><a href="./keys.html">Key setup</a></li>
          <li>
            <a href="./extras.html">Extras</a>
            <ul>
              <li><a href="./shift.html">Custom Shift/Caps Lock</a></li>
              <li><a href="./oled.html">OLED</a></li>
              <li><a href="./rotenc.html">Rotary Encoder</a></li>
            </ul>
          </li>
          <li><a href="./compile.html">Compiling</a></li>
          <li><a href="./upload.html">Uploading</a></li>
        </ul>
      </div>

      <div class="inputs">
        <span id="welcome">Compile!</span>

        <p>Woo! We're finally here. All the data has been collected, (well, almost all of it.) and all the extras set up.</p>
        <p>To begin compiling, first you'll need to install QMK MSYS, the firmware to use for the project.</p>
        <h2 id="windows">Windows</h2>
        <p>Install the .exe file for QMK MSYS from the latest release <a href="https://github.com/qmk/qmk_distro_msys/releases/tag/1.10.0">here</a></p>
        <h2 id="mac">Mac</h2>
        <p>Mac installation is a bit more complicated; first install Homebrew from <a href="https://brew.sh">https://brew.sh</a>. Don't worry, QMK uses this method on it's official website (<a href="https://docs.qmk.fm/newbs_getting_started">https://docs.qmk.fm</a>)</p>
        <p>Next, install QMK MSYS in your terminal by running <code class="language-c">brew install qmk/qmk/qmk</code>.</p>
        <h2 id="linux">Linux</h2>
        <p>First, be sure that you have Python and Git installed. It's very likely you do, but if you don't, install on Debian/Ubuntu/Devuan with <code class="language-c">sudo apt install -y git python3-pip</code></p>
        <p>Now install QMK MSYS with <code class="language-c">python3 -m pip install --user qmk</code></p>

        <h1>Setting up the keyboard</h1>
        <p>Great! Now that you've got QMK MSYS installed, we can move on to the next step.</p>
        <p>First, you need to make a file in a specific spot in the QMK folders.</p><p>Navigate to your <code class="language-c">qmk_firmware</code> folder which was made when you installed QMK MSYS, usually in your user folder. It should have many folders inside, such as .build, .git, data, docs, layouts, and keyboards. First ensure you're in the right folder, then navigate to the keyboards folder inside. This folder will have a ton of stuff in it. More specifically, all the preset keyboards.</p><p>Inside the keyboards folder, make a new folder. Give it the name of your keyboard, except DO NOT include spaces, special characters, or capital letters. This is important!</p>
        <p>Inside your new keyboard folder, create <code class="language-c">keyboard.json</code> and <code class="language-c">readme.md</code> files. Then make a folder named "keymaps" and inside <i>that</i>, a folder named "default". Finally, create <code class="language-c">keymap.c</code>, <code class="language-c">rules.mk</code>, and <code class="language-c">config.h</code> inside the "default" folder.</p>

        <p>Whew! That was a lot of file-making. Now, you're going to simply paste code into each file. Firstly, however, in the readme.md, write whatever you want inside to provide information about your keyboard. Maybe what inspired it, what it's all about. You can leave it blank if you want.</p>
        <p>But one thing you <i>can't</i> leave blank is the keyboard.json file. Inside, paste:</p>
        <pre><code id="keyboard.json" class="language-c">Hi
Mom</code></pre>

        <p>Gosh, that's a lot of code! Remember to fill in the placeholders I put in for you. Anyways, the next file we'll be editing is keymap.c. Open it up and paste in:</p>
        <pre><code id="keymap.c" class="language-c"></code></pre>
        
        <p>The end is near! Now it's time for rules.mk, the shortest yet:</p>
        <pre><code id="rules.mk" class="language-c"></code></pre>
        <p>If you want to add debugging for OLED, RE, etc. add these lines:</p>
        <pre><code class="language-c">CONSOLE_ENABLE = yes
DEBUG_MATRIX_SCAN_RATE = yes</code></pre>

        <p>Noice! Time for the very last file!! Hop into config.h and paste this in.</p>
        
        <pre><code id="config.h" class="language-c"></code></pre>

        <p>Wow! We're done coding! See, it's not that hard. Well. It was a pain for <em>me</em> to code, I can tell ya that. Anyways, there's only one very short step left. Head on over to <a href="./upload.html">upload!</a></p>
        
      </div>

      <div class="npbuts">
        <button id="prev" onclick="prev()">Previous</button>
        <button id="next" onclick="next()">Next</button>
      </div>
    </div>

    <script>
      const keyboard = document.getElementById("keyboard.json");
      const keymap = document.getElementById("keymap.c");
      const rules = document.getElementById("rules.mk");
      const config = document.getElementById("config.h");
      const oled = localStorage.getItem("OLED");
      const rotenc = localStorage.getItem("Rotenc");
      const keebname = localStorage.getItem("keebname");
      const bootloader = localStorage.getItem("microcontroller");
      const diode_direction = localStorage.getItem("diode_direction");
      const matcol = localStorage.getItem("matcol");
      const matrow = localStorage.getItem("matrow");
      const keynum = localStorage.getItem("keynum");
      var matrixEntries = [ // Example 3x4 Matrix
        {"matrix": [0,0], "x": 0, "y": 0},
        {"matrix": [0, 1], "x": 1, "y": 0},
        {"matrix": [0, 2], "x": 2, "y": 0},
        {"matrix": [1, 0], "x": 0, "y": 1},
        {"matrix": [1, 1], "x": 1, "y": 1},
        {"matrix": [1, 2], "x": 2, "y": 1},
       {"matrix": [2, 0], "x": 0, "y": 2},
        {"matrix": [2, 1], "x": 1, "y": 2},
        {"matrix": [2, 2], "x": 2, "y": 2},
        {"matrix": [3, 0], "x": 0, "y": 3},
         {"matrix": [3, 1], "x": 1, "y": 3},
        {"matrix": [3, 2], "x": 2, "y": 3}
      ]; // {"matrix": [row,col], "x": col, "y": row}
      var allKeys = {};
      var colPins = [];
      var rowPins = [];
      var bootmagic = false;
      var processor = "atmega32u4"
      var altBootloader = bootloader;

      // setup();

      var keyboardText =`{
    "manufacturer": "********YOUR NAME HERE**********",
    "keyboard_name": "${keebname}",
    "maintainer": "*******GITHUB USERNAME HERE*******",
    "bootloader": "${altBootloader}",
    "diode_direction": "${diode_direction}",
    "features": {
        "bootmagic": ${bootmagic},
        "command": false,
        "console": false,
        "extrakey": true,
        "mousekey": false,
        "nkro": true
    },
    "matrix_pins": {
        "cols": ${JSON.stringify(colPins, null)},
        "rows": ${JSON.stringify(rowPins, null)} 
    },
    "processor": "${processor}",
    "url": "(optional, leave blank otherwise)URL to an info page, i.e https://github.com/exampleuser/example, https://example.com.",
    "usb": {
        "device_version": "1.0.0",
        "pid": "0x0000",
        "vid": "0xFEED"
    },
    "layouts": {
        "LAYOUT_ortho_${matrow}x${matcol}": {
            "layout": [
                ${(JSON.stringify(matrixEntries, null))
                  .replace(/},/g, '},\n                ') // Replace ending }, with }, and then some tabs
                  .replace(/\[{/g, '{') // Replace [{ with { at beginning of string
                  .slice(0, -1)/* Remove last character, the unnecesary ]*/}
            ]
        }
    }
}
`;

      var keymapOledText = '';
      var keymapREText = '';
      var keymapText =`#include QMK_KEYBOARD_H

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = LAYOUT_ortho_3x4(
        KC_A, KC_B, KC_C,
        KC_D, KC_E, KC_F,
        KC_G, KC_H, KC_I,
        KC_J, KC_K, KC_L
    )
};${keymapOledText}
${keymapREText}`;
      
      var rulesOLEDText = '';
      var rulesREText = '';
      var rulesText = `${rulesOLEDText}${rulesREText}`;


      var configOledText = '';
      var configREText = '';
      var configText = `${configOledText}${configREText}`;
      
      const links = [
        "./index.html", //0
        "./start.html", //1
        "./keys.html", //2
        "./extras.html", //3
        "./shift.html", //4
        "./oled.html", //5
        "./rotenc.html", //6
        "./compile.html", //7 <--- You are here (thislink)
        "./upload.html", //8
      ];

      const thislink = 7;

      function prev() {
        window.location.href = links[thislink - 1];
      }
      function next() {
        window.location.href = links[thislink + 1];
      }
      function setup() {

        // Set processor and bootmagic
        switch (bootloader) {
          case "rp2040":
            processor = "rp2040";

            bootmagic = true;
            break;
          case "caterina":
            processor = "atmega32u4";

            bootmagic = true;
            break;
          case "halfkay":
            processor = "imxrt1062";
          
            bootmagic = true;
            break;
          case "halfkay-2":
            processor = "atmega32u4";
          
            bootmagic = true;
            break;
          case "samd":
            processor = "samd21";
          
            bootmagic = true;
            break;
          case "nrf-dfu":
            processor = "nrf52840";
          
            bootmagic = true;
            break;
          case "stm32-dfu":
            processor = "stm32l432";
          
            bootmagic = false;
            break;
          case "stm32-dfu-f103":
            processor = "stm32f103";
          
            bootmagic = false;
            break;
          case "stm32duino":
            processor = "stm32f103";
          
            bootmagic = false;
            break;
          case "espressif-dfu":
            processor = "espressif";
          
            bootmagic = false;
            break;
          case "none":
            processor = "YOUR PROCESSOR HERE (you selected none of the above on the first step.)"

            console.log("hi");

            bootmagic = false;
            break;
          default:
            bootmagic = false;
            break;
        }

        // Settle repeat bootloaders
        if (altBootloader == "halfkay-2") {
          altBootloader = "halfkay";
        } else if (altBootloader == "stm32-dfu-f103") {
          altBootloader = "stm32-dfu";
        } else if (altBootloader == "none") {
          altBootloader = "INPUT BOOTLOADER HERE! You selected none of the above at the first step."
        }
        
        // Setup Column and Row Pin definitions
        for (i = 0; i < matcol; i++) {
          if (i + 1 == matcol) {
            colPins.push("Replace these pin values (these strings included) with the pins connected to your matrix rows/columns.");
            continue;
          }
          colPins.push("D"+i);
        }
        for (j = 0; j < matrow; j++) {
          if (j + 1 == matrow) {
            rowPins.push("The D before each number MUST be replaced by the pin indicator of your microcontroller.");
            continue;
          }
          rowPins.push("D"+(j+parseInt(matrow)));
        }

        matrixEntries = [];
        
        // Setup Matrix (separate for function for readability)
        for (k = 0; k < matcol; k++) {
          for (l = 0; l < matrow; l++) {
            let ks = k.toString();
            let ls = l.toString();
            let lk = ls + "-" + ks;
            // console.log(lk);
            allKeys[lk] = localStorage.getItem(lk);
            matrixEntries.push({ "matrix": [l,k], "x": k, "y": l });
            //             {"matrix": [row,col], "x": col, "y": row}
          }
        }
        console.log(allKeys);

        // Remove matrix entries without keys

        Object.entries(allKeys).forEach(([key, value]) => {
          console.log(key + ": " + value);
          if (value === "NONE") {
            let key1 = parseInt(key.charAt(0));
            let key2 = parseInt(key.charAt(1));
            let key12 = [key1, key2];
            matrixEntries = matrixEntries.filter(element => JSON.stringify(element["matrix"]) != JSON.stringify(key12));
          }
        });


        // Setup keymap.c, rules.mk, config.h

        if (oled == "128x64" || oled == "128x32") {
          keymapOledText = `#ifdef OLED_ENABLE

bool oled_task_user() {
    oled_clear();
    oled_write_P(PSTR("Testing OLED!"), false); // Replace THIS line with whatever you'd like the OLED to display.
    // There are more details in the OLED page!
    return false;
}

#endif

`;
          rulesOLEDText = `OLED_ENABLE = yes
LTO_ENABLE = yes`;
          configOledText = `#define I2C1_SDA_PIN GP6
#define I2C1_SCL_PIN GP7 // Define which pins are SDA and SCL on your microcontroller model.
#define OLED_DRIVER_ENABLE

// You may need to add these if the OLED doesn't work at first.

#define OLED_I2C_ADDRESS 0x3C  // or 0x3D, depending on your OLED
#define OLED_DISPLAY_ON 1`;
          if (oled == "128x64") {
            configOledText = `#define I2C1_SDA_PIN GP6
#define I2C1_SCL_PIN GP7 // Define which pins are SDA and SCL on your microcontroller model.
#define OLED_DISPLAY_128x64 // Set the right resolution
#define OLED_DRIVER_ENABLE

// You may need to add these if the OLED doesn't work at first.

#define OLED_I2C_ADDRESS 0x3C  // or 0x3D, depending on your OLED
#define OLED_DISPLAY_ON 1`;
          }
        }
        if (rotenc == "true") {
          console.log(rotenc);
          keymapREText = `
bool encoder_update_user(uint8_t index, bool clockwise) {
    if (index == 0) { /* Encoder code */
        if (clockwise) {
            tap_code(KC_PGDN);
        } else {
            tap_code(KC_PGUP); // The QMK keycode value of choice. List at https://docs.qmk.fm/keycodes
        } // More info at the Rotary Encoder page
    }
    return false;
}

`;
          rulesREText = `
ENCODER_ENABLE = yes`;
          configREText = `
#define ENCODER_A_PINS { GP2 }
#define ENCODER_B_PINS { GP4 }`;
        }

        keymapText = `#include QMK_KEYBOARD_H

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = LAYOUT_ortho_3x4(
        KC_A, KC_B, KC_C,
        KC_D, KC_E, KC_F,
        KC_G, KC_H, KC_I,
        KC_J, KC_K, KC_L
    )
};${keymapOledText}
${keymapREText}`;
        rulesText = `${rulesOLEDText}${rulesREText}`;
        configText = `${configOledText}${configREText}`;


      }
      
      setup();
      setContent();
      function setContent() {
        keyboard.textContent = keyboardText;
        keymap.textContent = keymapText;
        rules.textContent = rulesText;
        config.textContent = configText;
      }
      setContent();
      
    </script>
  </body>
</html>
